syntax = "proto3";

package cirrina;
option go_package = "gitlab.mouf.net/swills/cirrina";

service VMInfo {
  rpc AddVM(VM) returns (VmID);
  rpc GetVM(VmID) returns (VM);
  rpc GetVMs(VMsQuery) returns (stream VmID);
  rpc UpdateVM(VmID) returns (ReqBool);
  rpc StartVM(VmID) returns (RequestID);
  rpc StopVM(VmID) returns (RequestID);
  rpc RequestStatus(RequestID) returns (ReqStatus);
  rpc GetVMState(VmID) returns (VMState);
}

message VmID {
  uint32 value = 1;
}

message VM {
  string name = 1;
  string description = 2;
  uint32 cpu = 3;
  uint32 mem = 4;
  uint32 max_wait = 5;
  bool restart = 6;
  uint32 restart_delay = 7;
  bool screen = 8;
  uint32 screen_width = 9;
  uint32 screen_height = 10;
}

message VMsQuery {
}

message RequestID {
  string value = 1;
}

message ReqStatus {
  bool complete = 1;
  bool success = 2;
}

message VMState {
  string status = 1;
  int32 VncPort = 2;
}

message ReqBool {
  bool success = 1;
}